pipeline {
  agent { label 'docker' } 

  stages{

    stage("deploy-to-staging"){
      when{
        changeset "**/worker/**"
      } 
      steps{
        container('jnlp'){
          sshagent(credentials: ['ssh-private-key-lb']) {
            sh '''
                env;
                echo "${GIT_COMMIT:0:7}";
                [ -d ~/.ssh ] || mkdir ~/.ssh && chmod 0700 ~/.ssh;
                ssh-keyscan -t rsa,dsa 10.81.81.21 >> ~/.ssh/known_hosts;
                ssh root@10.81.81.21 ls -lah /root/deploy/worker;
            '''
          }
        }
      }       
    }
  }
  post{
    always{
      echo 'Pipeline Complete'
    }
  }
}



